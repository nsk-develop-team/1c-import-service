# 1c-import-service

### Description:

Проект 1c-import-service получает список словарей с данными из RabbitMQ, 
заполняет ими XML документ по шаблону, архивирует XML документ и отправялет
в веб-сервис 1С файл целиком или частями.


### Get started:

python3 -m venv venv

python3 -m pip install --upgrade pip

. venv/bin/activate

python3 -m pip install -r requirements.txt


### Enviroment:

Для начала работы необходимо создать и заполнить .env файл следующими полями:

SERVICE_URL='URL 1С web-service' - ссылка на веб-сервис
LOGIN='login' - логин аккаунта
PASSWORD='password' - пароль аккаунта
LOGGING_LEVEL=20 - уровень логирования (20 - INFO)


### Tests:

Для тестирования работы отдельных функций в корневом каталоге в директории 
"tests/" находятся тестировочные файлы:
1. testCreator.py - тестовый запуск функции создания XML файла.
2. testPutDataTo1C.py - тестовый запуск функции отправки тестовых данных в сервис 1С.
3. testArchiver.py - тестовый запуск функции архивирования и разделения ZIP файла на части.


### Configurate:

В конфигурации находятся следующие переменные:
1. ACCOUNTS_CONFIG - словарь с словарями с данными об аккаунтах. Структура: 
    {'Имя аккаунта':{'Имя поля данных':'Значение поля данных'},...}

2. DOC_ROOT_PATH - путь до корневого элемента документа внутри дерева XML файла.

3. ACCOUNTS_PATHS - словарь в котором ключ - имя поля данных, значение - список путей
    куда небходимо вставить значения полей данных.
    Структура: {'Имя поля данных':[пути до элемента дерева документа]}

4. NAMES_MAP - словарь определяющий какие входные данные будут заполняться в шаблоне.
    Структура: {
        'Имя поля входных данных':'значение содержащее в себе путь, кортеж или False',
    }
        Возможные данные в значениях словаря:
        - False - поле с таким именем входных данных не будет обрабатываться
        - 'путь до соответствующего элемента дерева XML файла'
        - кортеж из двух элементов расширяющий количество путей и входных данных.
          Вначале идёт конфигурация данных, затем маппинг переменных и путей.
          Например: (ACCOUNTS_CONFIG, ACCOUNTS_PATHS)